(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{35763:function(e,t,l){Promise.resolve().then(l.bind(l,9671))},9671:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return FileArchiveSystem}});var n=l(57437),s=l(2265),i=l(65137),a=l(88110),r=l.n(a),c=l(13405),o=l(28170),d=l(43574),h=l(20273),p=l(89158),x=l(35302),j=l(80338),u=l(54760),g=l(33116),m=l(54637),y=l(40155),f=l(31405),v=l(66799),w=l(41088),Z=l(25747),b=l(46912),_=l(62074),k=l.n(_),C=l(88613);let analytics_event=e=>{let{action:t,category:l,label:n,value:s}=e;window.gtag&&window.gtag("event",t,{event_category:l,event_label:n,value:s})},trackFileUpload=e=>{analytics_event({action:"file_upload",category:"engagement",label:"files_uploaded_".concat(e),value:e})},trackFileClassification=(e,t)=>{analytics_event({action:"file_classification",category:"engagement",label:"".concat(e,"_").concat(t)})},trackFileDownload=e=>{analytics_event({action:"file_download",category:"conversion",label:"files_downloaded_".concat(e),value:e})},trackError=(e,t)=>{analytics_event({action:"error",category:"error",label:"".concat(t,": ").concat(e)})},{Dragger:N}=i.default,{Title:S,Text:P}=x.default,{TextArea:z}=d.default;function FileArchiveSystem(){var e,t;let[l,i]=(0,s.useState)(0),[a,x]=(0,s.useState)([]),[_,z]=(0,s.useState)("_"),[O,F]=(0,s.useState)(null),[E,I]=(0,s.useState)(null),[A,B]=(0,s.useState)(null),[D,L]=(0,s.useState)({}),[U,M]=(0,s.useState)(!1),[T,R]=(0,s.useState)(0),W=(0,s.useCallback)(e=>{let t=e.map(e=>{let t=e.name.lastIndexOf("."),l=t>0?e.name.substring(0,t):e.name,n=t>0?e.name.substring(t):"";return{file:e,name:e.name,parts:l.split(_),extension:n}});x(t),i(1),trackFileUpload(e.length)},[_]),q=(0,s.useCallback)(()=>{if(0===a.length)return;let e=a.map(e=>e.parts.length),t=Array.from(new Set(e));1===t.length?(F(!0),g.ZP.success("文件名校验通过！所有文件的分隔符数量一致"),i(2)):(F(!1),g.ZP.error("文件名校验不通过！文件分隔符数量不一致"),trackError("文件名格式校验失败","separator_validation"))},[a]),G=(0,s.useCallback)(()=>{if(null===E||null===A)return;let e={};a.forEach(t=>{let l=t.parts[E]||"未分类",n=t.parts[A]||"未分类";e[l]||(e[l]={}),e[l][n]||(e[l][n]=[]),e[l][n].push(t)}),L(e),i(4);let t=Object.keys(e),l=Object.values(e).flatMap(Object.keys);trackFileClassification(t.join(","),l.join(","))},[a,E,A]),handleDownload=async()=>{M(!0),R(0);try{let e=new(k()),t=0;for(let[l,n]of Object.entries(D)){let s=e.folder(l);for(let[e,l]of Object.entries(n)){let n=null==s?void 0:s.folder(e);for(let e of l){let l=await e.file.arrayBuffer();null==n||n.file(e.name,l),t++,R(Math.round(t/a.length*100))}}}let l=await e.generateAsync({type:"blob"});(0,C.saveAs)(l,"分类归档文件.zip"),g.ZP.success("文件打包下载完成！"),trackFileDownload(a.length)}catch(e){g.ZP.error("文件打包失败，请重试"),console.error("Download error:",e),trackError("文件打包失败","download_error")}finally{M(!1),R(0)}};return(0,n.jsxs)("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[(0,n.jsxs)(S,{level:2,style:{textAlign:"center",marginBottom:"32px"},children:[(0,n.jsx)(w.Z,{style:{marginRight:"8px",color:"#1890ff"}}),"文件自动分类系统"]}),(0,n.jsx)(c.Z,{current:l,items:[{title:"上传文件",description:"选择或拖拽文件到上传区域"},{title:"校验文件名",description:"验证文件分隔符格式"},{title:"一级分类",description:"选择一级分类字段"},{title:"二级分类",description:"选择二级分类字段"},{title:"预览下载",description:"查看分类结果并下载"}],style:{marginBottom:"32px"}}),0===l&&(0,n.jsx)(o.Z,{title:"步骤1: 上传文件",className:"step-content",children:(0,n.jsxs)(j.ZP,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{strong:!0,children:"请输入文件名分隔符："}),(0,n.jsx)(d.default,{value:_,onChange:e=>z(e.target.value),placeholder:"例如: _",style:{width:"200px",marginLeft:"12px"}})]}),(0,n.jsxs)(N,{multiple:!0,beforeUpload:()=>!1,onChange:e=>{let{fileList:t}=e,l=t.map(e=>e.originFileObj).filter(Boolean);l.length>0&&W(l)},className:"upload-dragger",children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(f.Z,{style:{fontSize:"48px",color:"#1890ff"}})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),(0,n.jsx)("p",{className:"ant-upload-hint",children:"支持批量上传多个文件，系统将根据文件名进行自动分类"})]})]})}),1===l&&(0,n.jsx)(o.Z,{title:"步骤2: 文件名校验",className:"step-content",children:(0,n.jsxs)(j.ZP,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsx)(h.Z,{message:"文件列表",description:"已上传 ".concat(a.length," 个文件，请检查文件名格式是否正确"),type:"info",showIcon:!0}),(0,n.jsx)("div",{className:"file-list",children:(0,n.jsx)(p.Z,{dataSource:a,renderItem:(e,t)=>(0,n.jsx)(p.Z.Item,{children:(0,n.jsxs)(j.ZP,{children:[(0,n.jsx)(v.Z,{className:"file-icon"}),(0,n.jsx)(P,{code:!0,children:e.name}),(0,n.jsxs)(P,{type:"secondary",children:["(分隔后: ",e.parts.join(" | "),")"]})]})},t)})}),(0,n.jsx)(r(),{type:"primary",size:"large",onClick:q,icon:(0,n.jsx)(b.Z,{}),children:"校验文件名格式"})]})}),2===l&&(0,n.jsx)(o.Z,{title:"步骤3: 一级分类设置",className:"step-content",children:(0,n.jsxs)(j.ZP,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsx)(h.Z,{message:"选择一级分类字段",description:"请选择用于一级分类的字段索引（从0开始）",type:"info",showIcon:!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{strong:!0,children:"字段索引："}),(0,n.jsx)(u.Z,{min:0,max:(null===(e=a[0])||void 0===e?void 0:e.parts.length)-1||0,value:E,onChange:e=>I(e),placeholder:"输入字段索引",style:{width:"200px",marginLeft:"12px"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{strong:!0,children:"预览效果："}),(0,n.jsxs)("div",{style:{marginTop:"8px"},children:[a.slice(0,3).map((e,t)=>(0,n.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,n.jsx)(P,{code:!0,children:e.name}),(0,n.jsxs)(P,{type:"secondary",children:["→ 将放入文件夹: ",e.parts[E||0]||"未分类"]})]},t)),a.length>3&&(0,n.jsxs)(P,{type:"secondary",children:["... 还有 ",a.length-3," 个文件"]})]})]}),(0,n.jsx)(r(),{type:"primary",size:"large",onClick:()=>i(3),disabled:null===E,children:"确认一级分类"})]})}),3===l&&(0,n.jsx)(o.Z,{title:"步骤4: 二级分类设置",className:"step-content",children:(0,n.jsxs)(j.ZP,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsx)(h.Z,{message:"选择二级分类字段",description:"请选择用于二级分类的字段索引（从0开始）",type:"info",showIcon:!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{strong:!0,children:"字段索引："}),(0,n.jsx)(u.Z,{min:0,max:(null===(t=a[0])||void 0===t?void 0:t.parts.length)-1||0,value:A,onChange:e=>B(e),placeholder:"输入字段索引",style:{width:"200px",marginLeft:"12px"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(P,{strong:!0,children:"预览效果："}),(0,n.jsxs)("div",{style:{marginTop:"8px"},children:[a.slice(0,3).map((e,t)=>(0,n.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,n.jsx)(P,{code:!0,children:e.name}),(0,n.jsxs)(P,{type:"secondary",children:["→ ",e.parts[E||0],"/",e.parts[A||0]]})]},t)),a.length>3&&(0,n.jsxs)(P,{type:"secondary",children:["... 还有 ",a.length-3," 个文件"]})]})]}),(0,n.jsx)(r(),{type:"primary",size:"large",onClick:G,disabled:null===A,children:"生成分类结构"})]})}),4===l&&(0,n.jsx)(o.Z,{title:"步骤5: 预览并下载",className:"step-content",children:(0,n.jsxs)(j.ZP,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsx)(h.Z,{message:"分类完成",description:"文件已按指定规则进行分类，请查看分类结构并下载",type:"success",showIcon:!0}),(0,n.jsxs)("div",{children:[(0,n.jsx)(S,{level:4,children:"文件夹结构预览："}),(0,n.jsx)("div",{className:"folder-structure",children:(0,n.jsx)("pre",{children:(()=>{let e=Object.entries(D).map(e=>{let[t,l]=e,n=Object.entries(l).map(e=>{let[t,l]=e,n=l.map(e=>e.name).join(", ");return"    └── ".concat(t,"/ (").concat(l.length,"个文件: ").concat(n,")")}).join("\n");return"".concat(t,"/\n").concat(n)}).join("\n");return e})()})})]}),(0,n.jsx)(y.Z,{}),(0,n.jsxs)(j.ZP,{children:[(0,n.jsx)(r(),{type:"primary",size:"large",icon:(0,n.jsx)(Z.default,{}),onClick:handleDownload,loading:U,children:"打包下载"}),U&&(0,n.jsx)("div",{style:{width:"200px"},children:(0,n.jsx)(m.default,{percent:T,status:"active"})})]})]})})]})}}},function(e){e.O(0,[211,971,472,744],function(){return e(e.s=35763)}),_N_E=e.O()}]);